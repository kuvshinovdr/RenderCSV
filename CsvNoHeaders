#include <iostream>
#include <fstream>
#include <sstream>
#include <vector>
#include <string>

struct TableData {
    std::string caption;
    std::vector<std::string> headers;
    std::vector<std::vector<std::string>> body;
};

std::vector<std::string> splitCsvLine(const std::string& line) {
    std::vector<std::string> fields;
    std::string field;
    bool in_quotes = false;
    for (char c : line) {
        if (c == '"') {
            in_quotes = !in_quotes;
        } else if (c == ',' && !in_quotes) {
            fields.push_back(field);
            field.clear();
        } else {
            field += c;
        }
    }
    fields.push_back(field);
    return fields;
}

void parseCsvNoHeaders(const std::string& filename, TableData& table) {
    std::ifstream file(filename);
    std::string line;

    if (file.is_open()) {
        while (std::getline(file, line)) {
            std::vector<std::string> fields = splitCsvLine(line);
            table.body.push_back(fields);
        }
        file.close();
    } else {
        std::cerr << "Не удалось открыть файл: " << filename << std::endl;
    }
}

void parseCsvWithHeaders(const std::string& filename, TableData& table) {
    parseCsvNoHeaders(filename, table);
    if (!table.body.empty()) {
        table.headers = table.body[0];
        table.body.erase(table.body.begin());
    }
}
